<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GameOnX - Jadwal Live</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes blink {0%,100%{opacity:1;}50%{opacity:0;}}
    .blink{animation:blink 1s infinite;}
    .card {background:#111;border-radius:8px;overflow:hidden;transition:.3s;}
    .card:hover{transform:translateY(-5px) scale(1.03);box-shadow:0 6px 15px rgba(0,0,0,.6);}
    .poster{width:100%;aspect-ratio:16/9;object-fit:cover;}
    .progress-bar{height:4px;border-radius:4px;overflow:hidden;margin-top:6px;}
    .progress-fill{height:100%;width:0%;transition:width 1s linear;}
  </style>
</head>
<body class="bg-black text-gray-200">

  <main class="max-w-6xl mx-auto px-4 pt-6 pb-20">
    <h2 class="text-xl font-bold text-white mb-6">Jadwal Volleyball</h2>
    <div id="channel-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
  </main>

  <script>
    async function loadSchedule(){
      const container=document.getElementById("channel-list");
      container.innerHTML="<div class='col-span-full text-center text-gray-400'>Loading...</div>";

      try{
        const res=await fetch("https://halu.serv00.net/poli.php");
        const html=await res.text();
        const doc=new DOMParser().parseFromString(html,"text/html");

        const cards=[...doc.querySelectorAll(".card")].map(c=>{
          const a=c.querySelector("a");
          const img=c.querySelector("img");
          const small=c.querySelector("small");

          let src=a?.href||"";
          let poster=img?.src||"";
          const title=img?.alt||a?.innerText||"";
          const timeText=small?.innerText||"";

          // fix url otomatis
          src=src.replace("/fM9jRrkN/","/fM9jRrkn/");
          poster=poster.replace("width=320","width=1920");

          return {title,src,poster,timeText};
        });

        container.innerHTML="";
        const now=new Date();

        cards.forEach((ch,i)=>{
          // parse tanggal WIB â†’ Date object
          let start=null;
          const match=ch.timeText.match(/(\d{2})-(\d{2})-(\d{4}) (\d{2}):(\d{2})/);
          if(match){
            const [_,d,m,y,h,min]=match.map(Number);
            // WIB = UTC+7
            start=new Date(Date.UTC(y,m-1,d,h-7,min));
          }

          let statusHTML="";
          let barColor="bg-green-500";
          let progress=0;
          if(start){
            const selisih=(start-now)/60000;
            if(now>=start){
              statusHTML=`<span class="text-red-400 font-bold blink">ðŸ”´ LIVE</span>`;
              barColor="bg-red-600";
              progress=100;
            }else{
              statusHTML=`<span class="text-gray-200">UPCOMING â€¢ ${Math.round(selisih)} menit lagi</span>`;
              if(selisih<=30) barColor="bg-red-500";
              else if(selisih<=60) barColor="bg-yellow-400";
              else barColor="bg-green-500";
              progress=Math.max(0,100-(selisih/60*100));
            }
          }

          container.innerHTML+=`
            <a href="/watch?url=${encodeURIComponent(ch.src)}&title=${encodeURIComponent(ch.title)}" 
              class="card p-2 ring-1 ${statusHTML.includes("LIVE")?'ring-red-500':'ring-gray-600'} fade-in"
              style="animation-delay:${i*0.1}s">
              <img src="${ch.poster}" class="poster">
              <div class="mt-2">
                <h3 class="text-sm font-semibold">${ch.title}</h3>
                <div class="text-xs mt-1">${ch.timeText}</div>
                <div class="mt-1">${statusHTML}</div>
                <div class="progress-bar bg-gray-700 mt-1">
                  <div class="progress-fill ${barColor}" style="width:${progress}%"></div>
                </div>
              </div>
            </a>`;
        });

      }catch(e){
        container.innerHTML="<div class='col-span-full text-center text-red-400'>Gagal memuat jadwal</div>";
        console.error(e);
      }
    }

    loadSchedule();
    setInterval(loadSchedule,60000);
  </script>
</body>
</html>
